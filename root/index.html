<!DOCTYPE html>
<html>
  <body>
    <h2>Reed Sheep paths: RSR</h2>

    <form>
      <label for="startPos"
        >Car start (red) position (x, y, heading in deg 0 to 360):</label
      ><br />
      <input
        type="text"
        id="startPos"
        name="startPos"
        value="(100, 100, 0)"
      /><br />
      <br />
      <label for="endPos">Car goal (green) position (x, y, heading): </label
      ><br />
      <input
        type="text"
        id="endPos"
        name="endPos"
        value="(200, 100, 90)"
      /><br /><br />
      <label for="turningRadius:">Turning radius:</label><br />
      <input
        type="text"
        id="turningRadius"
        name="turningRadius"
        value="50"
      /><br />
    </form>

    <button id="runButton" onclick="(() => {run(); draw();})()">
      Calculate
    </button>

    <p id="output0"></p>
    <p id="output1"></p>
    <p id="output2"></p>
    <p id="output3"></p>
    <p id="output4"></p>

    <canvas
      id="canvas"
      width="1000"
      height="1000"
      style="border: 1px solid #000000"
    ></canvas>

    <script type="text/javascript" src="ReedSheppPaths.js"></script>

    <script>
      var startCar;
      var endCar;
      var _A;
      var _B;
      var _r;
      var _cOrDAngle;

      function setOutput(...strs) {
        for (let i = 0; i < strs.length; ++i)
          document.getElementById('output' + i.toString()).innerHTML = strs[i];
      }

      function run() {
        // values
        const startValues = document
          .getElementById('startPos')
          .value.slice(1, -1)
          .split(',')
          .map((e) => Number(e));
        const endValues = document
          .getElementById('endPos')
          .value.slice(1, -1)
          .split(',')
          .map((e) => Number(e));
        startValues[2] = degToRad(startValues[2]);
        endValues[2] = degToRad(endValues[2]);
        const turningRadius = Number(
          document.getElementById('turningRadius').value
        );
        _r = turningRadius;

        const _startCar = {
          pos: { x: startValues[0], y: startValues[1] },
          heading: startValues[2]
        };

        const _endCar = {
          pos: { x: endValues[0], y: endValues[1] },
          heading: endValues[2]
        };

        startCar = _startCar;
        endCar = _endCar;

        const circAMidPoint = getRightCircle(_startCar, turningRadius);
        const circBMidPoint = getRightCircle(_endCar, turningRadius);

        _A = circAMidPoint;
        _B = circBMidPoint;

        const outputStr1 =
          'Right circle from start car middle point: { x: ' +
          circAMidPoint.x.toFixed(2) +
          ', y: ' +
          circAMidPoint.y.toFixed(2) +
          ' }';
        const outputStr2 =
          'Right circle from end car middle point: { x: ' +
          circBMidPoint.x.toFixed(2) +
          ', y: ' +
          circBMidPoint.y.toFixed(2) +
          ' }';

        const vals = getRSR(_startCar, _endCar);
        _cOrDAngle = vals.cOrDAngle;

        const outputStr3 = JSON.stringify(
          vals,
          (key, value) => {
            if (typeof value === 'number' && !key.startsWith('length'))
              return radToDeg(value).toFixed(2);
            else if (typeof value === 'number') return value.toFixed(2);
            else return value;
          },
          '<br>'
        );

        setOutput(
          outputStr1,
          outputStr2,
          'Angles in deg, lengths in units: ' + outputStr3
        );
      }
    </script>

    <script>
      const size = 1000;

      //const pxls = new Array(height).fill(new Array(width).fill(0));
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      const setPixel = (x, y, color) => {
        ctx.fillStyle = `rgb(${color[0]},${color[1]},${color[2]})`;
        ctx.fillRect(size / 2 + x - 2, size / 2 - y - 2, 4, 4);
      };

      const drawCircle = (x, y, r, color) => {
        ctx.beginPath();
        ctx.fillStyle = `rgb(${color[0]},${color[1]},${color[2]})`; // TODO
        ctx.arc(size / 2 + x, size / 2 - y, r, 0, Math.PI * 2);
        ctx.stroke();
      };

      function draw() {
        clearScreen();

        setPixel(startCar.pos.x, startCar.pos.y, [255, 0, 0]); // start car
        setPixel(endCar.pos.x, endCar.pos.y, [0, 255, 0]); // end car

        setPixel(_A.x, _A.y, [0, 0, 255]); // A
        setPixel(_B.x, _B.y, [255, 0, 255]); // B

        drawCircle(_A.x, _A.y, _r, [255, 0, 0]); // A circle
        drawCircle(_B.x, _B.y, _r, [255, 0, 0]); // B circle

        const C = {
          x: Math.floor(_A.x + Math.cos(_cOrDAngle) * _r),
          y: Math.floor(_A.y + Math.sin(_cOrDAngle) * _r)
        };

        const D = {
          x: Math.floor(_B.x + Math.cos(_cOrDAngle) * _r),
          y: Math.floor(_B.y + Math.sin(_cOrDAngle) * _r)
        };

        setPixel(C.x, C.y, [0, 255, 255]); // C

        setPixel(D.x, D.y, [255, 255, 0]); // D

        ctx.beginPath();
        ctx.moveTo(size / 2 + _A.x, size / 2 - _A.y);
        ctx.lineTo(size / 2 + _B.x, size / 2 - _B.y);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(size / 2 + C.x, size / 2 - C.y);
        ctx.lineTo(size / 2 + D.x, size / 2 - D.y);
        ctx.stroke();
      }

      function clearScreen() {
        for (let y = 0; y < size; ++y)
          for (let x = 0; x < size; ++x) setPixel(x, y, [255, 255, 255]);
      }
    </script>
  </body>
</html>
