<!DOCTYPE html>
<html>
  <body>
    <h2>Reed Sheep paths: RSR</h2>

    <form>
      <label for="startPos"
        >Car start (red) position (x, y, heading in deg 0 to 360):</label
      ><br />
      <input
        type="text"
        id="startPos"
        name="startPos"
        value="(100, 100, 0)"
      /><br />
      <br />
      <label for="endPos">Car goal (green) position (x, y, heading): </label
      ><br />
      <input
        type="text"
        id="endPos"
        name="endPos"
        value="(200, 100, 90)"
      /><br /><br />
      <label for="turningRadius:">Turning radius:</label><br />
      <input
        type="text"
        id="turningRadius"
        name="turningRadius"
        value="50"
      /><br />
    </form>

    <button id="runButton" onclick="(() => {run(); draw();})()">
      Calculate
    </button>

    <p id="output0"></p>
    <p id="output1"></p>
    <p id="output2"></p>
    <p id="output3"></p>
    <p id="output4"></p>

    <canvas
      id="canvas"
      width="1000"
      height="1000"
      style="border: 1px solid #000000"
    ></canvas>

    <script type="text/javascript" src="ReedSheppPaths.js"></script>

    <script>
      var startCar;
      var endCar;
      var _r;

      function setOutput(...strs) {
        for (let i = 0; i < strs.length; ++i)
          document.getElementById('output' + i.toString()).innerHTML = strs[i];
      }

      function run() {
        // #region html input values
        const startValues = document
          .getElementById('startPos')
          .value.slice(1, -1)
          .split(',')
          .map((e) => Number(e));
        const endValues = document
          .getElementById('endPos')
          .value.slice(1, -1)
          .split(',')
          .map((e) => Number(e));

        startValues[2] = ReedSheepPaths.degToRad(startValues[2]);
        endValues[2] = ReedSheepPaths.degToRad(endValues[2]);

        // get the values from the document
        const turningRadius = Number(
          document.getElementById('turningRadius').value
        );
        const _startCar = {
          pos: { x: startValues[0], y: startValues[1] },
          heading: startValues[2]
        };
        const _endCar = {
          pos: { x: endValues[0], y: endValues[1] },
          heading: endValues[2]
        };

        _r = turningRadius;
        startCar = _startCar;
        endCar = _endCar;
        // #endregion

        const vals = ReedSheepPaths.getRSR(_startCar, _endCar, turningRadius);
        const vals2 = ReedSheepPaths.getLSL(_startCar, _endCar, turningRadius);
        draw(vals.A, vals.B, vals.C, vals.D, vals.CMirror, vals.DMirror);
        draw(vals2.A, vals2.B, vals2.C, vals2.D, vals2.CMirror, vals2.DMirror);

        const outputStr1 =
          'Right circle from start car middle point: { x: ' +
          vals.A.x.toFixed(2) +
          ', y: ' +
          vals.A.y.toFixed(2) +
          ' }';
        const outputStr2 =
          'Right circle from end car middle point: { x: ' +
          vals.B.x.toFixed(2) +
          ', y: ' +
          vals.B.y.toFixed(2) +
          ' }';

        const outputStr3 = JSON.stringify(
          vals,
          (key, value) => {
            if (
              typeof value === 'number' &&
              !key.startsWith('length') &&
              key.length !== 1 &&
              !key.endsWith('Mirror')
            )
              return ReedSheepPaths.radToDeg(value).toFixed(2);
            else if (typeof value === 'number') return value.toFixed(2);
            else return value;
          },
          '<br>'
        );

        setOutput(
          outputStr1,
          outputStr2,
          'Angles in deg, lengths in units: ' + outputStr3
        );
      }
    </script>

    <script>
      const size = 1000;

      //const pxls = new Array(height).fill(new Array(width).fill(0));
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      const setPixel = (x, y, color) => {
        ctx.fillStyle = `rgb(${color[0]},${color[1]},${color[2]})`;
        ctx.fillRect(size / 2 + x - 2, size / 2 - y - 2, 4, 4);
      };

      const drawCircle = (x, y, r, color) => {
        ctx.beginPath();
        ctx.fillStyle = `rgb(${color[0]},${color[1]},${color[2]})`; // TODO
        ctx.arc(size / 2 + x, size / 2 - y, r, 0, Math.PI * 2);
        ctx.stroke();
      };

      function draw(__A, __B, __C, __D, __CMirror, __DMirror) {
        //clearScreen();

        setPixel(startCar.pos.x, startCar.pos.y, [255, 0, 0]); // start car
        setPixel(endCar.pos.x, endCar.pos.y, [0, 255, 0]); // end car

        setPixel(__A.x, __A.y, [0, 0, 255]); // A
        setPixel(__B.x, __B.y, [255, 0, 255]); // B

        drawCircle(__A.x, __A.y, _r, [255, 0, 0]); // A circle
        drawCircle(__B.x, __B.y, _r, [255, 0, 0]); // B circle

        const C = __C;

        const D = __D;

        const C2 = __CMirror;

        const D2 = __DMirror;

        setPixel(Math.floor(C.x), Math.floor(C.y), [0, 255, 255]); // C

        setPixel(Math.floor(D.x), Math.floor(D.y), [255, 255, 0]); // D

        setPixel(Math.floor(C2.x), Math.floor(C2.y), [0, 255, 255]); // C2

        setPixel(Math.floor(D2.x), Math.floor(D2.y), [255, 255, 0]); // D2

        // A TO B
        ctx.beginPath();
        ctx.moveTo(size / 2 + __A.x, size / 2 - __A.y);
        ctx.lineTo(size / 2 + __B.x, size / 2 - __B.y);
        ctx.stroke();

        // C TO D
        ctx.beginPath();
        ctx.moveTo(size / 2 + Math.floor(C.x), size / 2 - Math.floor(C.y));
        ctx.lineTo(size / 2 + Math.floor(D.x), size / 2 - Math.floor(D.y));
        ctx.stroke();

        // C2 TO D2
        ctx.beginPath();
        ctx.moveTo(size / 2 + Math.floor(C2.x), size / 2 - Math.floor(C2.y));
        ctx.lineTo(size / 2 + Math.floor(D2.x), size / 2 - Math.floor(D2.y));
        ctx.stroke();

        // check if they are valid (when equal to 0)
        //const tmp = (_A.x - _B.x) * (_A.x - C.x) + (_A.y - _B.y) * (_A.y - C.y);
        //console.log(tmp.toString(9));
      }

      function clearScreen() {
        for (let y = 0; y < size; ++y)
          for (let x = 0; x < size; ++x) setPixel(x, y, [255, 255, 255]);
      }
    </script>
  </body>
</html>
